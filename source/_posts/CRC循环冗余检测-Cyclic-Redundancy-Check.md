---
title: CRC循环冗余检测(Cyclic Redundancy Check)
date: 2016-10-23 11:57:17
tags: ['CRC','计算机网络']
---

# 基本原理

CRC检验（循环冗余校验码，Cyclic Redundancy Check）原理实际上就是在一个p位二进制数据序列之后附加一个r位二进制检验码(序列)，从而构成一个总长为n＝p＋r位的二进制序列；附加在数据序列之后的这个检验码与数据序列的内容之间存在着某种特定的关系。如果因干扰等原因使数据序列中的某一位或某些位发生错误，这种特定关系就会被破坏。因此，通过检查这一关系，就可以实现对数据正确性的检验。
<!-- more -->
# 几个基本概念

- 帧检验序列FCS（Frame Check Sequence）：为了进行差错检验而添加的冗余码。

- 多项式模2运行：实际上是按位异或(Exclusive OR)运算，即相同为0，相异为1，也就是不考虑进位、借位的二进制加减运算。如：10011011 + 11001010 = 01010001。

- 生成多项式（generator polynomial）：当进行CRC检验时，发送方与接收方需要事先约定一个除数，即生成多项式，一般记作G（x）。生成多项式的最高位与最低位必须是1。常用的CRC码的生成多项式有：
```
CRC8=X8+X5+X4+1

CRC-CCITT=X16+X12+X5+1

CRC16=X16+X15+X5+1

CRC12=X12+X11+X3+X2+1

CRC32=X32+X26+X23+X22+X16+X12+X11+X10+X8+X7+X5+X4+X2+X1+1
```

每一个生成多项式都可以与一个代码相对应，如`CRC8`对应代码：`100110001`。

# CRC检验码的计算

设信息字段为K位，校验字段为R位，则码字长度为N(N=K+R)。设双方事先约定了一个R次多项式g(x)，则CRC码：
```
V(x)=A(x)g(x)=xRm(x)+r(x)
```
其中: m(x)为K次信息多项式， r(x)为R-1次校验多项式。

这里r(x)对应的代码即为冗余码，加在原信息字段后即形成CRC码。

r(x)的计算方法为：在K位信息字段的后面添加R个0，再除以g(x)对应的代码序列，得到的余数即为r(x)对应的代码(应为R－1位；若不足，而在高位补0)。

**计算示例**

设需要发送的信息为M = 1010001101，产生多项式对应的代码为P = 110101，R＝5。

在M后加5个0，然后对P做模2除法运算，得余数r(x)对应的代码：`01110`。故实际需要发送的数据是`101000110101110`。

计算过程:
![](https://ws2.sinaimg.cn/large/647dc635jw1f922keolo2j20jo0cpmyg.jpg)

# 错误检测

当接收方收到数据后，用收到的数据对P（事先约定的）进行模2除法，若余数为0，则认为数据传输无差错；若余数不为0，则认为数据传输出现了错误，由于不知道错误发生在什么地方，因而不能进行自动纠正，一般的做法是丢弃接收的数据。

# Tips：

- CRC是一种常用的检错码，并不能用于自动纠错。

- 只要经过严格的挑选，并使用位数足够多的除数 P，那么出现检测不到的差错的概率就很小很小。

- 仅用循环冗余检验 CRC 差错检测技术只能做到无差错接受（只是非常近似的认为是无差错的），并不能保证可靠传输。


# 补充：CRC在优化关系数据库的关联查询的用途。

在优化关系数据库的关联查询的时候，ON的字段选择为数值型，必须是会比字符型的数据快很多的，那么如何将一个字符型的数据，唯一性地转为数值型呢？

一般我们会采用CRC32函数进行这个转换，CRC32会把字符串，生成一个long长整形的唯一性ID（虽然科学证明不绝对唯一，但是还是可用的）。

下面提供Java、Python以及MySQL的转换方法：

## 在MySQL数据库中，可以使用CRC32直接对字符串进行编码：
```MySQL
>>> SELECT CRC32('hello-world')
>>> 2983461467
```
## 在Java中，也是使用CRC32类，进行字符串编码：
```Java
import java.util.zip.CRC32;;

CRC32 crc32 = new CRC32();

crc32.update("hello-world".getBytes());

System.out.println(crc32.getValue());

2983461467
```
经过测试，和MySQL返回的值一致。

## 最后是Python，使用binascii包的crc32方法：

```Python
>>> import binascii
>>> print(binascii.crc32(b"hello world"))
>>> 222957957
```
